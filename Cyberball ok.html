<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cyberball Qualtrics</title>
<style>
body { font-family: sans-serif; text-align: center; margin-top: 50px; }
#game-container { display: flex; justify-content: center; align-items: center; height: 250px; position: relative; }
.player { width: 100px; height: 100px; border: 2px solid black; border-radius: 50%; line-height: 100px; font-weight: bold; margin: 0 50px; }
#ball { width: 50px; height: 50px; background: orange; border-radius: 50%; position: absolute; transition: all 0.5s ease; }
#message { margin-top: 30px; font-size: 1.2em; }
</style>
</head>
<body>

<h2>Cyberball</h2>
<div id="game-container">
  <div class="player" id="player0">You</div>
  <div class="player" id="player1">A</div>
  <div class="player" id="player2">B</div>
  <div id="ball"></div>
</div>
<div id="message"></div>

<script>
// ---------- CONFIGURATION ----------
const totalThrows = 30;
const players = [0,1,2];
const participantID = 0;

// Randomisation condition
const condition = Math.random() < 0.5 ? 'inclusion' : 'exclusion';

// Envoi Embedded Data vers Qualtrics
if(window.parent && window.parent.Qualtrics && window.parent.Qualtrics.SurveyEngine){
    window.parent.Qualtrics.SurveyEngine.setEmbeddedData('CyberballCondition', condition);
}

// ---------- INITIALISATION ----------
let throwCount = 0;
let currentHolder = participantID;
const ball = document.getElementById('ball');
const messageDiv = document.getElementById('message');

// Fonction pour positionner le ballon sur un joueur
function moveBall(playerIndex){
    const playerDiv = document.getElementById('player'+playerIndex);
    const rect = playerDiv.getBoundingClientRect();
    const containerRect = document.getElementById('game-container').getBoundingClientRect();
    ball.style.left = (rect.left - containerRect.left + rect.width/2 - 25) + "px";
    ball.style.top = (rect.top - containerRect.top + rect.height/2 - 25) + "px";
}

// ---------- LOGIQUE DES LANCERS ----------
function passBall(){
    throwCount++;
    let nextHolder;
    if(condition === 'inclusion'){
        nextHolder = players[Math.floor(Math.random()*3)];
    } else {
        if(throwCount <=2) nextHolder = participantID;
        else nextHolder = players[1 + Math.floor(Math.random()*2)];
    }
    currentHolder = nextHolder;
    moveBall(nextHolder);

    if(throwCount < totalThrows){
        setTimeout(passBall, 1000);
    } else {
        endGame();
    }
}

// ---------- FIN DU JEU ----------
function endGame(){
    ball.style.display = "none";
    messageDiv.innerText = "Le jeu est terminé. Merci de continuer le questionnaire.";
}

// ---------- DÉBUT ----------
window.onload = () => {
    moveBall(currentHolder);
    setTimeout(passBall, 1000);
};
</script>

</body>
</html>
