<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cyberball Qualtrics jsPsych</title>
<script src="https://cdn.jsdelivr.net/npm/jspsych@7.3.0/jspsych.js"></script>
<link href="https://cdn.jsdelivr.net/npm/jspsych@7.3.0/css/jspsych.css" rel="stylesheet">
<style>
body { font-family: sans-serif; text-align: center; margin-top: 50px; }
#jspsych-target { width: 800px; margin: 0 auto; }
.player { width: 100px; height: 100px; border-radius: 50%; border: 2px solid black; display: inline-block; line-height: 100px; font-weight: bold; margin: 0 50px; }
.ball { width: 50px; height: 50px; background: orange; border-radius: 50%; display: inline-block; vertical-align: middle; margin-left: 10px; }
</style>
</head>
<body>
<h2>Cyberball</h2>
<div id="jspsych-target"></div>

<script>
document.addEventListener("DOMContentLoaded", function(){

// ---------- CONFIGURATION ----------
const totalThrows = 30;
const players = ['You','A','B'];
const participantID = 0;

// Randomisation condition
const condition = Math.random() < 0.5 ? 'inclusion' : 'exclusion';

// Envoi Embedded Data vers Qualtrics
if(window.parent && window.parent.Qualtrics && window.parent.Qualtrics.SurveyEngine){
    window.parent.Qualtrics.SurveyEngine.setEmbeddedData('CyberballCondition', condition);
}

// ---------- GENERATION DES LANCERS ----------
let throws = [];
for(let i=0;i<totalThrows;i++){
    if(condition==='inclusion'){
        throws.push(players[Math.floor(Math.random()*3)]);
    } else {
        if(i<2) throws.push(players[participantID]); // participant reçoit 2 premières passes
        else throws.push(players[1 + Math.floor(Math.random()*2)]); // ensuite uniquement A ou B
    }
}

// ---------- AFFICHAGE SIMPLIFIE ----------
const container = document.getElementById('jspsych-target');
container.innerHTML = "<div id='game'></div><div id='message'></div>";
const gameDiv = document.getElementById('game');
const messageDiv = document.getElementById('message');

let currentThrow = 0;

function displayThrow(){
    gameDiv.innerHTML = '';
    players.forEach((p,i)=>{
        let playerDiv = document.createElement('div');
        playerDiv.className = 'player';
        playerDiv.innerText = p;
        if(throws[currentThrow]===p){
            let ballDiv = document.createElement('div');
            ballDiv.className = 'ball';
            playerDiv.appendChild(ballDiv);
        }
        gameDiv.appendChild(playerDiv);
    });
    currentThrow++;
    if(currentThrow<throws.length){
        setTimeout(displayThrow, 800); // 0.8s entre passes
    } else {
        messageDiv.innerText = "Le jeu est terminé. Merci de continuer le questionnaire.";
    }
}

// ---------- DÉBUT ----------
displayThrow();

});
</script>
</body>
</html>
